function koEntryFilterModel(n,t){var i=this;i.FilterPreviousMonth=ko.observable(new koEntryFilterMonthModel(n.PreviousMonth,t));i.FilterCurrentMonth=ko.observable(new koEntryFilterMonthModel(n.CurrentMonth,t));i.FilterNextMonth=ko.observable(new koEntryFilterMonthModel(n.NextMonth,t));i.FilterCurrentAccount=ko.observable(new koEntryFilterAccountModel(n.CurrentAccount));i.FilterAccountList=ko.observableArray();$.each(n.AccountList,function(n,t){i.FilterAccountList.push(new koEntryFilterAccountModel(t))})}function koEntryFilterMonthModel(n,t){var i=this;i.Text=ko.observable(n.Text);i.Year=ko.observable(n.Year);i.Month=ko.observable(n.Month);i.monthClick=function(n){t.monthClick(n)}}function koEntryFilterAccountModel(n){var t=this;t.ID=ko.observable(n.ID);t.Text=ko.observable(n.textValue)}function koEntryModel(n){var t=this,i;t.idEntry=ko.observable(n.idEntry);t.Text=ko.observable(n.Text);t.Type=ko.observable(n.Type);t.idCategory=ko.observable(n.idCategory);t.idCategoryText=ko.observable(n.idCategoryText);t.pureEntryValue=ko.observable(Math.abs(n.EntryValue));t.EntryValue=ko.observable(decimalFormated(t.pureEntryValue()));t.EntryValuePositive=ko.observable(n.EntryValue>=0);t.Balance=ko.observable(decimalFormated(n.Balance));i=!0;t.idAccount=ko.observable(n.idAccount);t.idAccountText=ko.observable(n.idAccountText);t.idAccountRelatedData=ko.observable();t.idAccountRelatedData.subscribe(function(){var f,r;if((!i||(i=!1,n.idAccount==0))&&(f=t.idAccountRelatedData(),f!=null)&&(r=JSON.parse(f.jsonValue),r.Type==accountTypeCreditCard)&&r.ClosingDay!=null&&r.ClosingDay!=0&&r.DueDay!=null&&r.DueDay!=0){var e=moment(),o=moment().date(r.ClosingDay),u=moment().date(r.DueDay);o<e&&u.add(1,"M");u<e&&u.add(1,"M");t.DueDate(u.format("L"))}},t);t.State=ko.observable(n.State);t.StateIcon=ko.computed(function(){return t.State()==1?"":t.State()==2?"warning":""},t);t.pureDueDate=ko.observable(moment(n.DueDate));t.DueDate=ko.observable(t.pureDueDate().format("L"));t.purePayDate=ko.observable(n.PayDate==null?null:moment(n.PayDate));t.PayDate=ko.observable(t.purePayDate()==null?"":t.purePayDate().format("L"));t.SearchDate=ko.observable(n.SearchDate);t.SearchDateDay=ko.computed(function(){return dateFromJson(t.SearchDate()).getDate()},t);t.SearchDateFormated=ko.computed(function(){return dateFormated(dateFromJson(t.SearchDate()))},t);t.Paid=ko.observable(n.Paid);t.Paid.subscribe(function(n){if(n){if(n&&t.PayDate()==""){var i=moment(),r=moment(t.DueDate(),dateFormat());i<r?t.PayDate(i.format("L")):t.PayDate(r.format("L"))}}else t.PayDate("")},t);t.idTransfer=ko.observable(n.idTransfer);t.idEntryIncome=ko.observable(n.idEntryIncome);t.idAccountIncome=ko.observable(n.idAccountIncome);t.idAccountIncomeText=ko.observable(n.idAccountIncomeText);t.idEntryExpense=ko.observable(n.idEntryExpense);t.idAccountExpense=ko.observable(n.idAccountExpense);t.idAccountExpenseText=ko.observable(n.idAccountExpenseText);t.idPattern=ko.observable(n.idPattern);t.idRecurrency=ko.observable(n.idRecurrency);t.idRecurrencyView=ko.observable(new koRecurrencyModel(n.idRecurrencyView))}function koRecurrencyModel(n){var t=this;n==null&&(n={idRecurrency:0,Type:2,Fixed:!0,Quantity:"",Update:0,hasRecurrency:!1});t.idRecurrency=ko.observable(n.idRecurrency);t.Type=ko.observable(n.Type);t.Fixed=ko.observable(n.Fixed);t.Fixed.subscribe(function(n){n||t.Quantity("")},t);t.Quantity=ko.observable(n.Quantity);t.Update=ko.observable(n.Update);t.hasRecurrency=ko.observable(n.hasRecurrency)}function koGroupModel(n,t,i){var r=this;r.Day=ko.observable(n);r.Date=ko.observable(t);r.FormatedDate=ko.observable(n+", "+moment(t).format("dddd"));r.searchDateFuture=ko.observable(i);r.pureBalance=ko.observable(0);r.positiveBalance=ko.computed(function(){return r.pureBalance()>=0},r);r.Balance=ko.computed(function(){return decimalFormated(r.pureBalance())},r);r.purePending=ko.observable(0);r.positivePending=ko.computed(function(){return r.purePending()>=0},r);r.Pending=ko.computed(function(){return decimalFormated(r.purePending())},r);r.State=ko.observable(0);r.StateIcon=ko.computed(function(){return r.State()==1?"":r.State()==2?"warning":""},r);r.Entries=ko.observableArray([])}var koEntryContext=function(){var n=this;n.isLoading=ko.observable(!1);n.CRUD=ko.dataFor(document.getElementById("entryModal"));n.CRUD.refresh=function(){n.refreshData()};n.data=ko.observableArray();n.dataUrl=function(){var t=GetActionUrl("Entries","GetData");return t+="?",t+="year="+n.currentFilter().year+"&",t+="month="+n.currentFilter().month+"&",t+("account="+n.currentFilter().account+"&")};n.currentFilter=ko.observable();n.loadData=function(t){t.date=moment(new Date(t.year,t.month-1,1));n.currentFilter(t);n.refreshData()};n.refreshData=function(){n.isLoading()||(n.isLoading(!0),n.data.removeAll(),GetDataJson({url:n.dataUrl(),success:function(t){if(t.Result){var i,r=0;$.each(t.Data,function(t,u){var e=dateFromJson(u.SearchDate),o=e.getDate(),f;(i==undefined||i==null||i.Day()!=o)&&(i=new koGroupModel(o,e,u.SearchDateFuture),i.purePending(r),n.data.push(i));f=new koEntryModel(u);i.pureBalance(u.Balance-r);f.State()==2&&(r+=u.EntryValue,i.purePending(r));i.State()<f.State()&&i.State(f.State());i.Entries.push(f)})}},done:function(){n.isLoading(!1)}}))};n.addIncome=function(){n.CRUD.addIncome(n.currentFilter().date)};n.addExpense=function(){n.CRUD.addExpense(n.currentFilter().date)};n.addTransfer=function(){n.CRUD.addTransfer(n.currentFilter().date)};n.openData=function(){var t=$(this)[0];n.CRUD.openData(t)};n.IsActiveUser=ko.computed(function(){return authIsActiveUser()},n)},koEntryCrud=function(){var n=this;n.isLoading=ko.observable(!1);n.refresh=null;n.addIncome=function(t){n.addData(entryTypeIncome,t)};n.addExpense=function(t){n.addData(entryTypeExpense,t)};n.addTransfer=function(t){n.addData(entryTypeTransfer,t)};n.addData=function(t,i){var u=moment(),f,r;i==undefined||i==null?i=u:i.year()==u.year()&&i.month()==u.month()&&(i=u);f="/Date("+i.toDate().getTime()+")/";r={idEntry:0,Text:"",Type:t,EntryValue:0,idCategory:0,idAccount:0,DueDate:f,SearchDate:f};t==entryTypeTransfer&&(r.idTransfer="",r.Text=msgTextEntryTypeTransfer,r.idEntryIncome=0,r.idAccountIncome=0,r.idEntryExpense=0,r.idAccountExpense=0);n.selectData(new koEntryModel(r))};n.openData=function(t){var i=ko.toJS(t),r;i.EntryValue=i.pureEntryValue;i.DueDate=i.pureDueDate;i.PayDate=i.purePayDate;r=new koEntryModel(i);n.selectData(r)};n.selectData=function(t){t.idEntry()<0||(n.selectedData(t),n.editForm.modal({startingTop:"0.5vh",endingTop:"3vh",ready:function(){n.editFormLoad()},show:!0}))};n.saveDataCurrent=function(){n.saveData()};n.saveDataFutures=function(){n.selectedData().idRecurrencyView().Update(1);n.saveData()};n.saveData=function(){n.isLoading(!0);PostDataJson({url:GetActionUrl("Entries","SaveData"),data:n.selectedDataJson(),success:function(){n.refresh!=null&&n.refresh();n.editForm.modal("close")},form:n.editForm,done:function(){n.isLoading(!1)}})};n.removeData=function(){n.isLoading(!0);PostDataJson({url:GetActionUrl("Entries","RemoveData"),data:n.selectedDataJson(),success:function(){n.refresh!=null&&n.refresh();n.editForm.modal("close")},form:n.editForm,done:function(){n.isLoading(!1)}})};n.selectedData=ko.observable();n.selectedDataJson=function(){var t=ko.toJS(n.selectedData);return t.DueDate=moment(t.DueDate,dateFormat()).toDate(),t.PayDate=moment(t.PayDate,dateFormat()).toDate(),t.SearchDate=dateFromJson(t.SearchDate),t.EntryValue=decimalWithouThousandSeparator(t.EntryValue),JSON.parse(JSON.stringify(t))};n.editForm=$("#entryModal");n.editFormLoad=function(){var t=n.selectedData(),i,f,u,e,r;$("select").material_select();$("#entryModal .dropdown-button").dropdown({constrainWidth:!1,belowOrigin:!0,alignment:"right"});$.each($(".apply-date-picker"),function(n,t){$(t).datepicker({})});i='""';t.Type()==entryTypeIncome?i='"Income"':t.Type()==entryTypeExpense&&(i='"Expense"');f=document.getElementById("idCategory");u=ko.dataFor(f);u.relatedFilter(i);e=document.getElementById("idPattern");r=ko.dataFor(e);r.inputTextDelayed.subscribe(function(n){t.idPattern(0);t.Text(n)});r.inputValue.subscribe(function(){var n=r.inputData(),i;n!=undefined&&n!=null&&(i=JSON.parse(n.jsonValue),t.idCategory(i.idCategory),u.relatedRefresh())});r.relatedFilter(i)};n.IsActiveUser=ko.computed(function(){return authIsActiveUser()},n)},koEntryFilterContext=function(n,t,i){var r=this;r.data=ko.observable();r.loadData=function(n,t,i){PostDataJson({url:GetActionUrl("Entries","GetInterval"),data:{Year:n,Month:t,Account:i},success:function(n){n.Result&&(r.data(new koEntryFilterModel(n.Data)),$(".dropdown-button").dropdown({constrainWidth:!1}),r.notifyRefresh())},done:function(){}})};r.currentFilterYear=function(){return r.data().FilterCurrentMonth().Year()};r.currentFilterMonth=function(){return r.data().FilterCurrentMonth().Month()};r.currentFilterAccount=function(){return r.data().FilterCurrentAccount().ID()};r.currentFilter=function(){return{year:r.currentFilterYear(),month:r.currentFilterMonth(),account:r.currentFilterAccount()}};r.notifyControl=ko.observable(0);r.notifyRefresh=function(){r.notifyControl(r.notifyControl()+1)};r.notifyDelayed=ko.pureComputed(r.notifyControl).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:1e3}});r.notifyDelayed.subscribe(function(){r.refreshData()},r);r.refreshData=function(){var n=ko.dataFor(document.getElementById("koEntry")),t;n==null?t=setInterval(function(){clearInterval(t);r.refreshData()},500):n.loadData(r.currentFilter())};r.monthClick=function(n){r.loadData(n.Year,n.Month,r.currentFilterAccount())};r.accountClick=function(n){r.loadData(r.currentFilterYear(),r.currentFilterMonth(),n.ID)};r.loadData(n,t,i)};