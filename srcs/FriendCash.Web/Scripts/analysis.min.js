function koAnalysisIntervalModel(n){var t=this;t.PreviousMonth=ko.observable(new koAnalysisIntervalItemModel(n.PreviousMonth));t.CurrentMonth=ko.observable(new koAnalysisIntervalItemModel(n.CurrentMonth));t.NextMonth=ko.observable(new koAnalysisIntervalItemModel(n.NextMonth))}function koAnalysisIntervalItemModel(n){var t=this;t.Text=ko.observable(n.Text);t.Year=ko.observable(n.Year);t.Month=ko.observable(n.Month);t.InitialDate=ko.observable(moment(n.InitialDate));t.FinalDate=ko.observable(moment(n.FinalDate))}function koAnalysisDataModel(n,t,i){var r=this;r.currentMonth=ko.observable(t);r.Dimensions=ko.observable(new koAnalysisDataDimensionsModel(n,r));r.filterControl=ko.observable(0);r.filterNotify=function(){r.filterControl(r.filterControl()+1)};r.filterDelayed=ko.pureComputed(r.filterControl).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:1e3}});r.filterDelayed.subscribe(function(){i.refreshData()},r)}function koAnalysisDataDimensionsModel(n,t){var i=this;i.Accounts=ko.observableArray();$.each(n.Dimensions.Accounts,function(n,r){i.Accounts.push(new koAnalysisDataDimensionModel(r,t))});i.Categories=ko.observableArray();$.each(n.Dimensions.Categories,function(n,r){i.Categories.push(new koAnalysisDataDimensionModel(r,t))});i.Patterns=ko.observableArray();$.each(n.Dimensions.Patterns,function(n,r){i.Patterns.push(new koAnalysisDataDimensionModel(r,t))});i.Planned=ko.observableArray();$.each(n.Dimensions.Planned,function(n,r){i.Planned.push(new koAnalysisDataDimensionModel(r,t))});i.Paid=ko.observableArray();$.each(n.Dimensions.Paid,function(n,r){i.Paid.push(new koAnalysisDataDimensionModel(r,t))})}function koAnalysisDataDimensionModel(n,t){var i=this;i.ID=ko.observable(n.ID);i.ParentText=ko.observable(n.ParentText);i.Text=ko.observable(n.Text);i.Type=ko.observable(n.Type);i.Selected=ko.observable(n.Selected);i.clicked=function(){i.Selected(!i.Selected());t.filterNotify()}}function graphDailyFlow(n,t){var i=new graphDailyFlowObject(n);i.Initialize();i.Update(t)}function graphCategoryDetails(n,t,i){var r=new graphCategoryDetailsObject(n,i);r.Initialize();r.Update(t)}function graphCategoryGoal(n,t){var i=new graphCategoryGoalObject(n);i.Initialize();i.Update(t)}function graphCategoryTrend(n,t){var i=new graphCategoryTrendObject(n);i.Initialize();i.Update(t)}function graphBalanceTrend(n,t){var i=new graphBalanceTrendObject(n);i.Initialize();i.Update(t)}function graphCumulatedEntries(n,t){var i=new graphCumulatedEntriesObject(n);i.Initialize();i.Update(t)}var koAnalysisIntervalContext=function(n,t){var i=this;i.data=ko.observable();i.loadData=function(n,t){PostDataJson({url:GetActionUrl("Analysis","GetInterval"),data:{Year:n,Month:t},success:function(n){if(n.Result){i.data(new koAnalysisIntervalModel(n.Data));var t=ko.toJS(i.data().CurrentMonth());i.notifyRefresh(t)}},done:function(){}})};i.notifyParams=null;i.notifyControl=ko.observable(0);i.notifyRefresh=function(n){i.notifyParams=n;i.notifyControl(i.notifyControl()+1)};i.notifyDelayed=ko.pureComputed(i.notifyControl).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:1e3}});i.notifyDelayed.subscribe(function(){i.refreshData(i.notifyParams)},i);i.refreshData=function(n){var t=ko.dataFor(document.getElementById("koAnalysisData")),r;t==null?r=setInterval(function(){clearInterval(r);i.refreshData(n)},500):t.loadData(n)};i.click=function(n){i.loadData(n.Year,n.Month)};i.optionsActive=ko.observable(!1);i.optionsClick=function(){i.optionsActive(!i.optionsActive());i.optionsActive()?($("#mainAnalysisGraph").addClass("l8").addClass("pull-l4"),$("#mainAnalysisData").removeClass("hide").addClass("l4").addClass("push-l8")):($("#mainAnalysisGraph").removeClass("l8").removeClass("pull-l4"),$("#mainAnalysisData").addClass("hide").removeClass("l4").removeClass("push-l8"));window.dispatchEvent(new Event("resize"))};i.loadData(n,t)},koAnalysisDataContext=function(){var n=this;n.isLoading=function(t){n.graphContext(function(n){n.isLoading(t)})};n.data=ko.observable();n.loadData=function(t){n.isLoading(!0);PostDataJson({url:GetActionUrl("Analysis","GetData"),data:{Year:t.Year,Month:t.Month},success:function(i){i.Result&&(n.data(new koAnalysisDataModel(i.Data,t,n)),n.limitHeight(),n.refreshData())},error:function(){n.isLoading(!1)}})};n.limitHeight=function(){var i=$("#koAnalysisData").offset().top,r=$("footer").offset().top,u=$("#koAnalysisData .collapsible-header").height(),n=r-i-u*6.5,t=Math.abs($("#koAnalysisData .collection-item").height())*6;n<t&&(n=t);$("#koAnalysisData .collapsible-body").css("max-height",n).css("overflow-y","scroll")};n.refreshData=function(){n.isLoading(!0);var t=JSON.parse(ko.toJSON(n.data));PostDataJson({url:GetActionUrl("Analysis","GetGraphs"),data:t,success:function(t){t.Result&&(t.Data.data.currentMonth=ko.toJS(n.data().currentMonth),n.graphContext(function(n){n.loadData(t.Data);n.isLoading(!1)}))},error:function(){n.isLoading(!1)}})};n.graphContext=function(t){var i=ko.dataFor(document.getElementById("koAnalysisGraph")),r;i==null?r=setInterval(function(){clearInterval(r);n.graphContext(t)},500):t(i)}},koAnalysisGraphContext=function(){var n=this;n.isLoading=ko.observable(!1);n.highColors=["#7cb5ec","#90ed7d","#f7a35c","#8085e9","#f15c80","#e4d354","#2b908f","#f45b5b","#91e8e1","#434348"];n.colors=["#64b5f6","#aed581","#ff8a65","#7986cb","#f06292","#ffd54f","#4db6ac","#e57373","#4dd0e1","#455a64"];n.redColor="#c62828";n.greenColor="#2e7d32";n.blueColor="#1565c0 ";n.data=ko.observable();n.dailyFlow=ko.observable();n.categoryExpenseDetails=ko.observable();n.categoryIncomeDetails=ko.observable();n.categoryGoal=ko.observable();n.categoryTrend=ko.observable();n.balanceTrend=ko.observable();n.cumulatedEntries=ko.observable();n.loadData=function(t){n.data(t.data);n.dailyFlow(t.dailyFlow);n.categoryExpenseDetails(t.categoryExpenseDetails);n.categoryIncomeDetails(t.categoryIncomeDetails);n.categoryGoal(t.categoryGoal);n.categoryTrend(t.categoryTrend);n.balanceTrend(t.balanceTrend);n.cumulatedEntries(t.cumulatedEntries)}},graphDailyFlowObject=function(n){var t=this;t.graphObject=null;t.graphProperties=null;t.container=$(n.previousElementSibling);t.Initialize=function(){t.graphProperties={chart:{type:"area",renderTo:t.container[0],backgroundColor:"transparent"},title:{text:titleDailyFlow,align:"left"},credits:{enabled:!1},xAxis:{categories:[],tickmarkPlacement:"on",showFirstLabel:!1,title:{enabled:!1},labels:{enabled:!1},tickLength:1},yAxis:{min:0,title:{enabled:!1},labels:{enabled:!0,formatter:function(){return Number(this.value).toLocaleString(navigator.language,{minimumFractionDigits:0})}}},legend:{verticalAlign:"bottom",symbolHeight:8,enabled:!0},tooltip:{shared:!0,formatter:function(){if(this.x==0)return!1;var n="<strong>"+this.x+"<\/strong>";return $.each(this.points,function(){n+='<br/><span style="color:'+this.color+'">●<\/span> <span>'+this.series.name+"<\/span>: <strong>"+decimalFormated(this.y)+"<\/strong>"}),n}},plotOptions:{area:{marker:{symbol:"circle",radius:2},stacking:"normal"}},series:[{name:" ",color:"#fff"},{name:" ",color:"#fff"},{name:" ",color:"#fff"}]};t.graphObject=new Highcharts.Chart(t.graphProperties)};t.Update=function(n){var i=n.dailyFlow(),r;i!=undefined&&(t.graphObject.xAxis[0].update({categories:i.category}),i.unpaid.color=Highcharts.Color(n.redColor).brighten(.5).get(),t.graphObject.series[0].update(i.unpaid),i.unplanned.color=Highcharts.Color(n.redColor).brighten(.2).get(),t.graphObject.series[1].update(i.unplanned),i.paid.color=n.redColor,t.graphObject.series[2].update(i.paid),r=null,i.currentDay>0&&(r=[{value:i.currentDay,color:n.redColor,label:{text:labelDailyFlowToday,rotation:-90,align:"right",x:-4,y:0,style:{fontSize:"1.3vh"}},zIndex:10,width:1}]),t.graphObject.xAxis[0].update({plotLines:r}))}},graphCategoryDetailsObject,graphCategoryGoalObject,graphCategoryTrendObject,graphBalanceTrendObject,graphCumulatedEntriesObject;$(".daily-flow-expandable-button").click(function(n){var r=$(n.target),t=r.parents(".card");t.hasClass("expanded")?t.removeClass("expanded"):t.addClass("expanded");var u=t.find("code"),i=u[0],f=ko.dataFor(i);graphDailyFlow(i,f)});graphCategoryDetailsObject=function(n,t){var i=this;i.graphObject=null;i.graphProperties=null;i.container=$(n.previousElementSibling);i.Initialize=function(){i.graphProperties={chart:{type:"pie",renderTo:i.container[0],events:{drilldown:function(n){this.addSeriesAsDrilldown(n.point,{data:n.point.options.drillData})},drillup:function(){}},backgroundColor:"transparent"},title:{text:t==enCategoryTypeExpense?titleCategoryExpenseDetails:titleCategoryIncomeDetails,align:"left"},credits:{enabled:!1},legend:{enabled:!1},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0,distance:-5,formatter:function(){return this.percentage>2?this.point.name:null}}}},tooltip:{formatter:function(){return'<span style="color:'+this.color+'">●<\/span> <span>'+this.point.name+"<\/span>: <strong>"+decimalFormated(this.point.y)+"<\/strong>"}},series:[{name:"MAIN",data:[]}],drilldown:{drillUpButton:{relativeTo:"spacingBox",position:{align:"left",y:25,x:0}},series:[]}};Highcharts.setOptions({lang:{drillUpText:"<<"}});i.graphObject=new Highcharts.Chart(i.graphProperties)};i.Update=function(n){var a=n.colors,r=null,o,u,s,f,h,e,c,l;if(t==enCategoryTypeExpense?r=n.categoryExpenseDetails():t==enCategoryTypeIncome&&(r=n.categoryIncomeDetails()),r!=undefined){for(o=0;o<r.seriesData.length;o++)for(u=r.seriesData[o],u.color=a[u.colorIndex],s=0;s<u.drillData.length;s++){for(f=u.drillData[s],f.color=Highcharts.Color(u.color).brighten(f.colorBrightness).get(),h=0;h<f.drillData.length;h++)e=f.drillData[h],e.color=Highcharts.Color(f.color).brighten(e.colorBrightness).get();for(c=0;c<e.drillData.length;c++)l=e.drillData[c],l.color=Highcharts.Color(e.color).brighten(l.colorBrightness).get()}i.graphObject.series[0].update({data:r.seriesData},!1);i.graphObject.redraw()}}};$(".category-details-expandable-button").click(function(n){var r=$(n.target),t=r.parents(".card");t.hasClass("expanded")?t.removeClass("expanded"):t.addClass("expanded");var u=t.find("code"),i=u[0],f=ko.dataFor(i),e=t.attr("data-additional-param");graphCategoryDetails(i,f,e)});graphCategoryGoalObject=function(n){var t=this;t.graphObject=null;t.graphProperties=null;t.container=$(n.previousElementSibling);t.Initialize=function(){t.graphProperties={chart:{type:"column",renderTo:t.container[0],backgroundColor:"transparent"},title:{text:titleCategoryGoal,align:"left"},credits:{enabled:!1},legend:{enabled:!1},plotOptions:{series:{stacking:"normal",borderWidth:0}},xAxis:{categories:[],title:{enabled:!1},labels:{rotation:-90,enabled:!0,reserveSpace:!1,align:"left",y:-5,style:{color:"#000",textShadow:"0px 0px 5px white"}},tickWidth:0},yAxis:{title:{enabled:!1},plotLines:[{value:100,color:"green",label:{text:labelCategoryGoal,x:0,style:{fontSize:"1.3vh"}},zIndex:7,width:2}],labels:{enabled:!1}},tooltip:{shared:!0,formatter:function(){var n="";return $.each(this.points,function(){this.point.goalValue>0&&(n='<br/><span style="color:green">●<\/span> <span>'+labelCategoryGoal+"<\/span>: <strong>"+decimalFormated(this.point.goalValue)+"<\/strong>"+n);n+='<br/><span style="color:'+this.color+'">●<\/span> <span>'+this.series.name+"<\/span>: <strong>"+decimalFormated(this.point.realValue)+"<\/strong>"}),n="<strong>"+this.x+"<\/strong>"+n}},series:[{name:" ",color:"#fff"},{name:" ",color:"#fff"}]};t.graphObject=new Highcharts.Chart(t.graphProperties)};t.Update=function(n){var i=n.categoryGoal(),f=n.colors,r,u;if(i!=undefined){for(r=0;r<i.paidData.data.length;r++)u=i.paidData.data[r],u.color=f[u.colorIndex];for(r=0;r<i.unpaidData.data.length;r++)u=i.unpaidData.data[r],u.color=Highcharts.Color(f[u.colorIndex]).brighten(u.colorBrightness).get();t.graphObject.xAxis[0].update({categories:i.categoryList});t.graphObject.yAxis[0].update({gridLineColor:"transparent",tickPositions:[0,100,i.maxValue],max:i.maxValue});t.graphObject.series[0].update(i.unpaidData);t.graphObject.series[1].update(i.paidData)}}};$(".category-goal-expandable-button").click(function(n){var r=$(n.target),t=r.parents(".card");t.hasClass("expanded")?t.removeClass("expanded"):t.addClass("expanded");var u=t.find("code"),i=u[0],f=ko.dataFor(i);graphCategoryGoal(i,f)});graphCategoryTrendObject=function(n){var t=this;t.graphObject=null;t.graphProperties=null;t.container=$(n.previousElementSibling);t.Initialize=function(){t.graphProperties={chart:{type:"line",renderTo:t.container[0],backgroundColor:"transparent"},title:{text:titleCategoryTrend,align:"left"},credits:{enabled:!1},legend:{align:"right",verticalAlign:"middle",layout:"vertical",symbolHeight:8,enabled:!0},xAxis:{categories:[],tickmarkPlacement:"on",title:{enabled:!1},labels:{enabled:!0},tickLength:1},yAxis:{title:{enabled:!1},labels:{enabled:!0,formatter:function(){return Number(this.value).toLocaleString(navigator.language,{minimumFractionDigits:0})}}},plotOptions:{line:{marker:{symbol:"circle",radius:2}}},tooltip:{shared:!0,formatter:function(){for(var n,r="<strong>"+this.x+"<\/strong>",t=[],i=0;i<this.points.length;i++)n=this.points[i],t.push({name:n.series.name,value:n.y,color:n.color});return t.sort(function(n,t){return parseFloat(t.value)-parseFloat(n.value)}),$.each(t,function(){r+='<br/><span style="color:'+this.color+'">●<\/span> <span>'+this.name+"<\/span>: <strong>"+decimalFormated(this.value)+"<\/strong>"}),r}},series:[]};t.graphObject=new Highcharts.Chart(t.graphProperties)};t.Update=function(n){var i=n.categoryTrend(),e=n.colors,r,u,f;if(i!=undefined){if(t.graphObject.xAxis[0].update({categories:i.categoryList}),t.graphObject.series!=undefined)for(r=t.graphObject.series.length-1;r>=0;r--)t.graphObject.series[r].remove();for(u=0;u<i.seriesData.length;u++)f=i.seriesData[u],f.color=e[f.colorIndex],t.graphObject.addSeries(f)}}};$(".category-trend-expandable-button").click(function(n){var r=$(n.target),t=r.parents(".card");t.hasClass("expanded")?t.removeClass("expanded"):t.addClass("expanded");var u=t.find("code"),i=u[0],f=ko.dataFor(i);graphCategoryTrend(i,f)});graphBalanceTrendObject=function(n){var t=this;t.graphObject=null;t.graphProperties=null;t.container=$(n.previousElementSibling);t.Initialize=function(){t.graphProperties={chart:{renderTo:t.container[0],backgroundColor:"transparent"},title:{text:titleBalanceTrend,align:"left"},credits:{enabled:!1},legend:{align:"right",verticalAlign:"middle",layout:"vertical",symbolHeight:8,enabled:!0},xAxis:{categories:[],tickmarkPlacement:"on",title:{enabled:!1},labels:{enabled:!0},tickLength:1},yAxis:[{title:{enabled:!1},labels:{enabled:!0,formatter:function(){return Number(this.value).toLocaleString(navigator.language,{minimumFractionDigits:0})}}},{title:{enabled:!1},labels:{enabled:!1}}],plotOptions:{series:{stacking:"normal"}},tooltip:{shared:!0,formatter:function(){var n="<strong>"+this.x+"<\/strong>";return $.each(this.points,function(){n+='<br/><span style="color:'+this.color+'">●<\/span> <span>'+this.series.name+"<\/span>: <strong>"+decimalFormated(this.y)+"<\/strong>"}),n}},series:[{name:" ",type:"column",yAxis:0,color:"#fff"},{name:" ",type:"column",yAxis:0,color:"#fff"},{name:" ",type:"line",yAxis:1,lineWidth:1,marker:{enabled:!0,radius:2},color:"#fff"}]};t.graphObject=new Highcharts.Chart(t.graphProperties)};t.Update=function(n){var i=n.balanceTrend();i!=undefined&&(t.graphObject.xAxis[0].update({categories:i.categoryList}),i.IncomeData.color=Highcharts.Color(n.greenColor).brighten(.2).get(),t.graphObject.series[0].update(i.IncomeData),i.ExpenseData.color=Highcharts.Color(n.redColor).brighten(.2).get(),t.graphObject.series[1].update(i.ExpenseData),i.BalanceData.color=Highcharts.Color(n.blueColor).brighten(.2).get(),t.graphObject.series[2].update(i.BalanceData),t.graphObject.yAxis[1].update({min:i.limits.minValue,max:i.limits.maxValue}))}};$(".balance-trend-expandable-button").click(function(n){var r=$(n.target),t=r.parents(".card");t.hasClass("expanded")?t.removeClass("expanded"):t.addClass("expanded");var u=t.find("code"),i=u[0],f=ko.dataFor(i);graphBalanceTrend(i,f)});graphCumulatedEntriesObject=function(n){var t=this;t.graphObject=null;t.graphProperties=null;t.container=$(n.previousElementSibling);t.Initialize=function(){t.graphProperties={chart:{renderTo:t.container[0],backgroundColor:"transparent"},title:{text:titleCumulatedEntries,align:"left"},credits:{enabled:!1},legend:{enabled:!1},xAxis:{categories:[],title:{enabled:!1},labels:{rotation:-90,enabled:!0,step:1,reserveSpace:!1,align:"left",y:-2,style:{color:"#000",textShadow:"0px 0px 5px white"}},tickLength:1},yAxis:[{title:{enabled:!1},labels:{enabled:!0,formatter:function(){return Number(this.value).toLocaleString(navigator.language,{minimumFractionDigits:0})}}},{min:0,max:100,title:{enabled:!1},gridLineWidth:0,labels:{enabled:!1}}],tooltip:{shared:!0,formatter:function(){return'<span style="color:'+this.color+'">'+this.x+"<\/span>:<br/><strong>"+decimalFormated(this.y)+"<\/strong> (<span>"+this.points[1].y+"%<\/span>)"}},series:[{name:"VALUES",type:"column"},{name:"PARETO",type:"spline",yAxis:1,lineWidth:1,marker:{enabled:!0,radius:2}}]};t.graphObject=new Highcharts.Chart(t.graphProperties)};t.Update=function(n){var i=n.cumulatedEntries(),r;i!=undefined&&(t.graphObject.xAxis[0].update({categories:i.categoryList}),r=Highcharts.Color(n.blueColor).brighten(.2).get(),t.graphObject.series[0].update({color:r,data:i.data}),t.graphObject.series[1].update({color:n.blueColor,data:i.pareto}))}};$(".cumulated-entries-expandable-button").click(function(n){var r=$(n.target),t=r.parents(".card");t.hasClass("expanded")?t.removeClass("expanded"):t.addClass("expanded");var u=t.find("code"),i=u[0],f=ko.dataFor(i);graphCumulatedEntries(i,f)});